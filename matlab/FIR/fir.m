clc;
clear;
close;
% FIR Low-pass Filter Design using Hamming Window
%https://chat.openai.com/share/3ede23dc-11d1-4a85-b5b7-0659a86a3e7a
% Specifications
order = 52;                     % Filter order
cutoff_frequency = 3.5e3;       % Cutoff frequency in Hz
sampling_rate = 48.00e3;         % Sampling rate in Hz
num_points = 512 ;


values = [-0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037 -0.153865 -0.200999 -0.244747 -0.284276 -0.318942 -0.348181 -0.371410 -0.388346 -0.398583 -0.402032 -0.398602 -0.388321 -0.371449 -0.348160 -0.318967 -0.284286 -0.244740 -0.201036 -0.153840 -0.104072 -0.052469 0.000000 0.052469 0.104072 0.153840 0.201036 0.244740 0.284286 0.318967 0.348160 0.371449 0.388321 0.398602 0.402032 0.398583 0.388346 0.371410 0.348181 0.318942 0.284276 0.244747 0.200999 0.153865 0.104037 0.052483 0.000000 -0.052483 -0.104037];
% Design the FIR filter using Hamming window
fir_coefficients = fir1(order, cutoff_frequency/(sampling_rate/2), 'low', hamming(order + 1));

% Display the coefficients
%disp('FIR Coefficients:');
%disp(fir_coefficients);

% Time vector
t = 0:1/sampling_rate:(num_points-1)*1/sampling_rate;

% Generate signals
signal = .4*(sin(2*pi*1000*t));
noise = 0.0*sin(2*pi*2000*t) + 0.1*sin(2*pi*20000*t);
noisy_signal = noise + signal;

filtered_noisy_signal = filter(fir_coefficients, 1, noisy_signal);
%filtered_noise = filter(fir_coefficients, 1, noise);
%filtered_signal = filter(fir_coefficients, 1, signal);

fir_coefficients_fixed = fi(fir_coefficients, true, 16, 15);
filtered_noisy_signal_fixed = fi(filtered_noisy_signal, true, 32, 30);
noisy_signal_fixed = fi(noisy_signal, true, 16, 15);

% Write content to files in hexadecimal format
%write_to_file(fir_coefficients_fixed, 'D:\Digital_Electronics\DSP\DSP_course\dv\FIR\fir_coefficients.hex');
write_to_file(noisy_signal_fixed, 'D:\Digital_Electronics\DSP\DSP_course\dv\FIR\noisy_signal_array.hex');
write_to_file(filtered_noisy_signal_fixed, 'D:\Digital_Electronics\DSP\DSP_course\dv\FIR\filtered_noisy_signal_array.hex');


% Plot original signal
figure;
subplot(2, 1, 1);
plot(t, noisy_signal_fixed);
title('Original Signal (Before Filtering)');
xlabel('Time (s)');
ylabel('Amplitude');

% Plot filtered signal
subplot(2, 1, 2);
plot(t, filtered_noisy_signal_fixed);
title('Filtered Signal (After Filtering)');
xlabel('Time (s)');
ylabel('Amplitude');